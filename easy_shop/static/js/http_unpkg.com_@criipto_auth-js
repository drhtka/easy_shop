!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CriiptoAuth=t():e.CriiptoAuth=t()}(self,(()=>(()=>{var e={987:e=>{"use strict";var t={single_source_shortest_paths:function(e,r,n){var o={},i={};i[r]=0;var s,a,c,u,d,l,h,p=t.PriorityQueue.make();for(p.push(r,0);!p.empty();)for(c in a=(s=p.pop()).value,u=s.cost,d=e[a]||{})d.hasOwnProperty(c)&&(l=u+d[c],h=i[c],(void 0===i[c]||h>l)&&(i[c]=l,p.push(c,l),o[c]=a));if(void 0!==n&&void 0===i[n]){var f=["Could not find a path from ",r," to ",n,"."].join("");throw new Error(f)}return o},extract_shortest_path_from_predecessor_list:function(e,t){for(var r=[],n=t;n;)r.push(n),e[n],n=e[n];return r.reverse(),r},find_path:function(e,r,n){var o=t.single_source_shortest_paths(e,r,n);return t.extract_shortest_path_from_predecessor_list(o,n)},PriorityQueue:{make:function(e){var r,n=t.PriorityQueue,o={};for(r in e=e||{},n)n.hasOwnProperty(r)&&(o[r]=n[r]);return o.queue=[],o.sorter=e.sorter||n.default_sorter,o},default_sorter:function(e,t){return e.cost-t.cost},push:function(e,t){var r={value:e,cost:t};this.queue.push(r),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return 0===this.queue.length}}};e.exports=t},378:e=>{"use strict";e.exports=function(e){for(var t=[],r=e.length,n=0;n<r;n++){var o=e.charCodeAt(n);if(o>=55296&&o<=56319&&r>n+1){var i=e.charCodeAt(n+1);i>=56320&&i<=57343&&(o=1024*(o-55296)+i-56320+65536,n+=1)}o<128?t.push(o):o<2048?(t.push(o>>6|192),t.push(63&o|128)):o<55296||o>=57344&&o<65536?(t.push(o>>12|224),t.push(o>>6&63|128),t.push(63&o|128)):o>=65536&&o<=1114111?(t.push(o>>18|240),t.push(o>>12&63|128),t.push(o>>6&63|128),t.push(63&o|128)):t.push(239,191,189)}return new Uint8Array(t).buffer}},592:(e,t,r)=>{const n=r(138),o=r(115),i=r(907),s=r(776);function a(e,t,r,i,s){const a=[].slice.call(arguments,1),c=a.length,u="function"==typeof a[c-1];if(!u&&!n())throw new Error("Callback required as last argument");if(!u){if(c<1)throw new Error("Too few arguments provided");return 1===c?(r=t,t=i=void 0):2!==c||t.getContext||(i=r,r=t,t=void 0),new Promise((function(n,s){try{const s=o.create(r,i);n(e(s,t,i))}catch(e){s(e)}}))}if(c<2)throw new Error("Too few arguments provided");2===c?(s=r,r=t,t=i=void 0):3===c&&(t.getContext&&void 0===s?(s=i,i=void 0):(s=i,i=r,r=t,t=void 0));try{const n=o.create(r,i);s(null,e(n,t,i))}catch(e){s(e)}}t.create=o.create,t.toCanvas=a.bind(null,i.render),t.toDataURL=a.bind(null,i.renderToDataURL),t.toString=a.bind(null,(function(e,t,r){return s.render(e,r)}))},138:e=>{e.exports=function(){return"function"==typeof Promise&&Promise.prototype&&Promise.prototype.then}},845:(e,t,r)=>{const n=r(242).getSymbolSize;t.getRowColCoords=function(e){if(1===e)return[];const t=Math.floor(e/7)+2,r=n(e),o=145===r?26:2*Math.ceil((r-13)/(2*t-2)),i=[r-7];for(let e=1;e<t-1;e++)i[e]=i[e-1]-o;return i.push(6),i.reverse()},t.getPositions=function(e){const r=[],n=t.getRowColCoords(e),o=n.length;for(let e=0;e<o;e++)for(let t=0;t<o;t++)0===e&&0===t||0===e&&t===o-1||e===o-1&&0===t||r.push([n[e],n[t]]);return r}},260:(e,t,r)=>{const n=r(910),o=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function i(e){this.mode=n.ALPHANUMERIC,this.data=e}i.getBitsLength=function(e){return 11*Math.floor(e/2)+e%2*6},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(e){let t;for(t=0;t+2<=this.data.length;t+=2){let r=45*o.indexOf(this.data[t]);r+=o.indexOf(this.data[t+1]),e.put(r,11)}this.data.length%2&&e.put(o.indexOf(this.data[t]),6)},e.exports=i},245:e=>{function t(){this.buffer=[],this.length=0}t.prototype={get:function(e){const t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(let r=0;r<t;r++)this.putBit(1==(e>>>t-r-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},e.exports=t},280:e=>{function t(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}t.prototype.set=function(e,t,r,n){const o=e*this.size+t;this.data[o]=r,n&&(this.reservedBit[o]=!0)},t.prototype.get=function(e,t){return this.data[e*this.size+t]},t.prototype.xor=function(e,t,r){this.data[e*this.size+t]^=r},t.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]},e.exports=t},424:(e,t,r)=>{const n=r(378),o=r(910);function i(e){this.mode=o.BYTE,"string"==typeof e&&(e=n(e)),this.data=new Uint8Array(e)}i.getBitsLength=function(e){return 8*e},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(e){for(let t=0,r=this.data.length;t<r;t++)e.put(this.data[t],8)},e.exports=i},393:(e,t,r)=>{const n=r(908),o=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],i=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];t.getBlocksCount=function(e,t){switch(t){case n.L:return o[4*(e-1)+0];case n.M:return o[4*(e-1)+1];case n.Q:return o[4*(e-1)+2];case n.H:return o[4*(e-1)+3];default:return}},t.getTotalCodewordsCount=function(e,t){switch(t){case n.L:return i[4*(e-1)+0];case n.M:return i[4*(e-1)+1];case n.Q:return i[4*(e-1)+2];case n.H:return i[4*(e-1)+3];default:return}}},908:(e,t)=>{t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2},t.isValid=function(e){return e&&void 0!==e.bit&&e.bit>=0&&e.bit<4},t.from=function(e,r){if(t.isValid(e))return e;try{return function(e){if("string"!=typeof e)throw new Error("Param is not a string");switch(e.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+e)}}(e)}catch(e){return r}}},526:(e,t,r)=>{const n=r(242).getSymbolSize;t.getPositions=function(e){const t=n(e);return[[0,0],[t-7,0],[0,t-7]]}},642:(e,t,r)=>{const n=r(242),o=n.getBCHDigit(1335);t.getEncodedBits=function(e,t){const r=e.bit<<3|t;let i=r<<10;for(;n.getBCHDigit(i)-o>=0;)i^=1335<<n.getBCHDigit(i)-o;return 21522^(r<<10|i)}},729:(e,t)=>{const r=new Uint8Array(512),n=new Uint8Array(256);!function(){let e=1;for(let t=0;t<255;t++)r[t]=e,n[e]=t,e<<=1,256&e&&(e^=285);for(let e=255;e<512;e++)r[e]=r[e-255]}(),t.log=function(e){if(e<1)throw new Error("log("+e+")");return n[e]},t.exp=function(e){return r[e]},t.mul=function(e,t){return 0===e||0===t?0:r[n[e]+n[t]]}},442:(e,t,r)=>{const n=r(910),o=r(242);function i(e){this.mode=n.KANJI,this.data=e}i.getBitsLength=function(e){return 13*e},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(e){let t;for(t=0;t<this.data.length;t++){let r=o.toSJIS(this.data[t]);if(r>=33088&&r<=40956)r-=33088;else{if(!(r>=57408&&r<=60351))throw new Error("Invalid SJIS character: "+this.data[t]+"\nMake sure your charset is UTF-8");r-=49472}r=192*(r>>>8&255)+(255&r),e.put(r,13)}},e.exports=i},126:(e,t)=>{t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};function r(e,r,n){switch(e){case t.Patterns.PATTERN000:return(r+n)%2==0;case t.Patterns.PATTERN001:return r%2==0;case t.Patterns.PATTERN010:return n%3==0;case t.Patterns.PATTERN011:return(r+n)%3==0;case t.Patterns.PATTERN100:return(Math.floor(r/2)+Math.floor(n/3))%2==0;case t.Patterns.PATTERN101:return r*n%2+r*n%3==0;case t.Patterns.PATTERN110:return(r*n%2+r*n%3)%2==0;case t.Patterns.PATTERN111:return(r*n%3+(r+n)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}}t.isValid=function(e){return null!=e&&""!==e&&!isNaN(e)&&e>=0&&e<=7},t.from=function(e){return t.isValid(e)?parseInt(e,10):void 0},t.getPenaltyN1=function(e){const t=e.size;let r=0,n=0,o=0,i=null,s=null;for(let a=0;a<t;a++){n=o=0,i=s=null;for(let c=0;c<t;c++){let t=e.get(a,c);t===i?n++:(n>=5&&(r+=n-5+3),i=t,n=1),t=e.get(c,a),t===s?o++:(o>=5&&(r+=o-5+3),s=t,o=1)}n>=5&&(r+=n-5+3),o>=5&&(r+=o-5+3)}return r},t.getPenaltyN2=function(e){const t=e.size;let r=0;for(let n=0;n<t-1;n++)for(let o=0;o<t-1;o++){const t=e.get(n,o)+e.get(n,o+1)+e.get(n+1,o)+e.get(n+1,o+1);4!==t&&0!==t||r++}return 3*r},t.getPenaltyN3=function(e){const t=e.size;let r=0,n=0,o=0;for(let i=0;i<t;i++){n=o=0;for(let s=0;s<t;s++)n=n<<1&2047|e.get(i,s),s>=10&&(1488===n||93===n)&&r++,o=o<<1&2047|e.get(s,i),s>=10&&(1488===o||93===o)&&r++}return 40*r},t.getPenaltyN4=function(e){let t=0;const r=e.data.length;for(let n=0;n<r;n++)t+=e.data[n];return 10*Math.abs(Math.ceil(100*t/r/5)-10)},t.applyMask=function(e,t){const n=t.size;for(let o=0;o<n;o++)for(let i=0;i<n;i++)t.isReserved(i,o)||t.xor(i,o,r(e,i,o))},t.getBestMask=function(e,r){const n=Object.keys(t.Patterns).length;let o=0,i=1/0;for(let s=0;s<n;s++){r(s),t.applyMask(s,e);const n=t.getPenaltyN1(e)+t.getPenaltyN2(e)+t.getPenaltyN3(e)+t.getPenaltyN4(e);t.applyMask(s,e),n<i&&(i=n,o=s)}return o}},910:(e,t,r)=>{const n=r(114),o=r(7);t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(e,t){if(!e.ccBits)throw new Error("Invalid mode: "+e);if(!n.isValid(t))throw new Error("Invalid version: "+t);return t>=1&&t<10?e.ccBits[0]:t<27?e.ccBits[1]:e.ccBits[2]},t.getBestModeForData=function(e){return o.testNumeric(e)?t.NUMERIC:o.testAlphanumeric(e)?t.ALPHANUMERIC:o.testKanji(e)?t.KANJI:t.BYTE},t.toString=function(e){if(e&&e.id)return e.id;throw new Error("Invalid mode")},t.isValid=function(e){return e&&e.bit&&e.ccBits},t.from=function(e,r){if(t.isValid(e))return e;try{return function(e){if("string"!=typeof e)throw new Error("Param is not a string");switch(e.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+e)}}(e)}catch(e){return r}}},85:(e,t,r)=>{const n=r(910);function o(e){this.mode=n.NUMERIC,this.data=e.toString()}o.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)},o.prototype.getLength=function(){return this.data.length},o.prototype.getBitsLength=function(){return o.getBitsLength(this.data.length)},o.prototype.write=function(e){let t,r,n;for(t=0;t+3<=this.data.length;t+=3)r=this.data.substr(t,3),n=parseInt(r,10),e.put(n,10);const o=this.data.length-t;o>0&&(r=this.data.substr(t),n=parseInt(r,10),e.put(n,3*o+1))},e.exports=o},143:(e,t,r)=>{const n=r(729);t.mul=function(e,t){const r=new Uint8Array(e.length+t.length-1);for(let o=0;o<e.length;o++)for(let i=0;i<t.length;i++)r[o+i]^=n.mul(e[o],t[i]);return r},t.mod=function(e,t){let r=new Uint8Array(e);for(;r.length-t.length>=0;){const e=r[0];for(let o=0;o<t.length;o++)r[o]^=n.mul(t[o],e);let o=0;for(;o<r.length&&0===r[o];)o++;r=r.slice(o)}return r},t.generateECPolynomial=function(e){let r=new Uint8Array([1]);for(let o=0;o<e;o++)r=t.mul(r,new Uint8Array([1,n.exp(o)]));return r}},115:(e,t,r)=>{const n=r(242),o=r(908),i=r(245),s=r(280),a=r(845),c=r(526),u=r(126),d=r(393),l=r(882),h=r(103),p=r(642),f=r(910),g=r(130);function w(e,t,r){const n=e.size,o=p.getEncodedBits(t,r);let i,s;for(i=0;i<15;i++)s=1==(o>>i&1),i<6?e.set(i,8,s,!0):i<8?e.set(i+1,8,s,!0):e.set(n-15+i,8,s,!0),i<8?e.set(8,n-i-1,s,!0):i<9?e.set(8,15-i-1+1,s,!0):e.set(8,15-i-1,s,!0);e.set(n-8,8,1,!0)}function m(e,t,r,o){let p;if(Array.isArray(e))p=g.fromArray(e);else{if("string"!=typeof e)throw new Error("Invalid data");{let n=t;if(!n){const t=g.rawSplit(e);n=h.getBestVersionForData(t,r)}p=g.fromString(e,n||40)}}const m=h.getBestVersionForData(p,r);if(!m)throw new Error("The amount of data is too big to be stored in a QR Code");if(t){if(t<m)throw new Error("\nThe chosen QR Code version cannot contain this amount of data.\nMinimum version required to store current data is: "+m+".\n")}else t=m;const y=function(e,t,r){const o=new i;r.forEach((function(t){o.put(t.mode.bit,4),o.put(t.getLength(),f.getCharCountIndicator(t.mode,e)),t.write(o)}));const s=8*(n.getSymbolTotalCodewords(e)-d.getTotalCodewordsCount(e,t));for(o.getLengthInBits()+4<=s&&o.put(0,4);o.getLengthInBits()%8!=0;)o.putBit(0);const a=(s-o.getLengthInBits())/8;for(let e=0;e<a;e++)o.put(e%2?17:236,8);return function(e,t,r){const o=n.getSymbolTotalCodewords(t),i=o-d.getTotalCodewordsCount(t,r),s=d.getBlocksCount(t,r),a=s-o%s,c=Math.floor(o/s),u=Math.floor(i/s),h=u+1,p=c-u,f=new l(p);let g=0;const w=new Array(s),m=new Array(s);let y=0;const v=new Uint8Array(e.buffer);for(let e=0;e<s;e++){const t=e<a?u:h;w[e]=v.slice(g,g+t),m[e]=f.encode(w[e]),g+=t,y=Math.max(y,t)}const E=new Uint8Array(o);let A,b,S=0;for(A=0;A<y;A++)for(b=0;b<s;b++)A<w[b].length&&(E[S++]=w[b][A]);for(A=0;A<p;A++)for(b=0;b<s;b++)E[S++]=m[b][A];return E}(o,e,t)}(t,r,p),v=n.getSymbolSize(t),E=new s(v);return function(e,t){const r=e.size,n=c.getPositions(t);for(let t=0;t<n.length;t++){const o=n[t][0],i=n[t][1];for(let t=-1;t<=7;t++)if(!(o+t<=-1||r<=o+t))for(let n=-1;n<=7;n++)i+n<=-1||r<=i+n||(t>=0&&t<=6&&(0===n||6===n)||n>=0&&n<=6&&(0===t||6===t)||t>=2&&t<=4&&n>=2&&n<=4?e.set(o+t,i+n,!0,!0):e.set(o+t,i+n,!1,!0))}}(E,t),function(e){const t=e.size;for(let r=8;r<t-8;r++){const t=r%2==0;e.set(r,6,t,!0),e.set(6,r,t,!0)}}(E),function(e,t){const r=a.getPositions(t);for(let t=0;t<r.length;t++){const n=r[t][0],o=r[t][1];for(let t=-2;t<=2;t++)for(let r=-2;r<=2;r++)-2===t||2===t||-2===r||2===r||0===t&&0===r?e.set(n+t,o+r,!0,!0):e.set(n+t,o+r,!1,!0)}}(E,t),w(E,r,0),t>=7&&function(e,t){const r=e.size,n=h.getEncodedBits(t);let o,i,s;for(let t=0;t<18;t++)o=Math.floor(t/3),i=t%3+r-8-3,s=1==(n>>t&1),e.set(o,i,s,!0),e.set(i,o,s,!0)}(E,t),function(e,t){const r=e.size;let n=-1,o=r-1,i=7,s=0;for(let a=r-1;a>0;a-=2)for(6===a&&a--;;){for(let r=0;r<2;r++)if(!e.isReserved(o,a-r)){let n=!1;s<t.length&&(n=1==(t[s]>>>i&1)),e.set(o,a-r,n),i--,-1===i&&(s++,i=7)}if(o+=n,o<0||r<=o){o-=n,n=-n;break}}}(E,y),isNaN(o)&&(o=u.getBestMask(E,w.bind(null,E,r))),u.applyMask(o,E),w(E,r,o),{modules:E,version:t,errorCorrectionLevel:r,maskPattern:o,segments:p}}t.create=function(e,t){if(void 0===e||""===e)throw new Error("No input text");let r,i,s=o.M;return void 0!==t&&(s=o.from(t.errorCorrectionLevel,o.M),r=h.from(t.version),i=u.from(t.maskPattern),t.toSJISFunc&&n.setToSJISFunction(t.toSJISFunc)),m(e,r,s,i)}},882:(e,t,r)=>{const n=r(143);function o(e){this.genPoly=void 0,this.degree=e,this.degree&&this.initialize(this.degree)}o.prototype.initialize=function(e){this.degree=e,this.genPoly=n.generateECPolynomial(this.degree)},o.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");const t=new Uint8Array(e.length+this.degree);t.set(e);const r=n.mod(t,this.genPoly),o=this.degree-r.length;if(o>0){const e=new Uint8Array(this.degree);return e.set(r,o),e}return r},e.exports=o},7:(e,t)=>{const r="[0-9]+";let n="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";n=n.replace(/u/g,"\\u");const o="(?:(?![A-Z0-9 $%*+\\-./:]|"+n+")(?:.|[\r\n]))+";t.KANJI=new RegExp(n,"g"),t.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),t.BYTE=new RegExp(o,"g"),t.NUMERIC=new RegExp(r,"g"),t.ALPHANUMERIC=new RegExp("[A-Z $%*+\\-./:]+","g");const i=new RegExp("^"+n+"$"),s=new RegExp("^"+r+"$"),a=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");t.testKanji=function(e){return i.test(e)},t.testNumeric=function(e){return s.test(e)},t.testAlphanumeric=function(e){return a.test(e)}},130:(e,t,r)=>{const n=r(910),o=r(85),i=r(260),s=r(424),a=r(442),c=r(7),u=r(242),d=r(987);function l(e){return unescape(encodeURIComponent(e)).length}function h(e,t,r){const n=[];let o;for(;null!==(o=e.exec(r));)n.push({data:o[0],index:o.index,mode:t,length:o[0].length});return n}function p(e){const t=h(c.NUMERIC,n.NUMERIC,e),r=h(c.ALPHANUMERIC,n.ALPHANUMERIC,e);let o,i;return u.isKanjiModeEnabled()?(o=h(c.BYTE,n.BYTE,e),i=h(c.KANJI,n.KANJI,e)):(o=h(c.BYTE_KANJI,n.BYTE,e),i=[]),t.concat(r,o,i).sort((function(e,t){return e.index-t.index})).map((function(e){return{data:e.data,mode:e.mode,length:e.length}}))}function f(e,t){switch(t){case n.NUMERIC:return o.getBitsLength(e);case n.ALPHANUMERIC:return i.getBitsLength(e);case n.KANJI:return a.getBitsLength(e);case n.BYTE:return s.getBitsLength(e)}}function g(e,t){let r;const c=n.getBestModeForData(e);if(r=n.from(t,c),r!==n.BYTE&&r.bit<c.bit)throw new Error('"'+e+'" cannot be encoded with mode '+n.toString(r)+".\n Suggested mode is: "+n.toString(c));switch(r!==n.KANJI||u.isKanjiModeEnabled()||(r=n.BYTE),r){case n.NUMERIC:return new o(e);case n.ALPHANUMERIC:return new i(e);case n.KANJI:return new a(e);case n.BYTE:return new s(e)}}t.fromArray=function(e){return e.reduce((function(e,t){return"string"==typeof t?e.push(g(t,null)):t.data&&e.push(g(t.data,t.mode)),e}),[])},t.fromString=function(e,r){const o=function(e){const t=[];for(let r=0;r<e.length;r++){const o=e[r];switch(o.mode){case n.NUMERIC:t.push([o,{data:o.data,mode:n.ALPHANUMERIC,length:o.length},{data:o.data,mode:n.BYTE,length:o.length}]);break;case n.ALPHANUMERIC:t.push([o,{data:o.data,mode:n.BYTE,length:o.length}]);break;case n.KANJI:t.push([o,{data:o.data,mode:n.BYTE,length:l(o.data)}]);break;case n.BYTE:t.push([{data:o.data,mode:n.BYTE,length:l(o.data)}])}}return t}(p(e,u.isKanjiModeEnabled())),i=function(e,t){const r={},o={start:{}};let i=["start"];for(let s=0;s<e.length;s++){const a=e[s],c=[];for(let e=0;e<a.length;e++){const u=a[e],d=""+s+e;c.push(d),r[d]={node:u,lastCount:0},o[d]={};for(let e=0;e<i.length;e++){const s=i[e];r[s]&&r[s].node.mode===u.mode?(o[s][d]=f(r[s].lastCount+u.length,u.mode)-f(r[s].lastCount,u.mode),r[s].lastCount+=u.length):(r[s]&&(r[s].lastCount=u.length),o[s][d]=f(u.length,u.mode)+4+n.getCharCountIndicator(u.mode,t))}}i=c}for(let e=0;e<i.length;e++)o[i[e]].end=0;return{map:o,table:r}}(o,r),s=d.find_path(i.map,"start","end"),a=[];for(let e=1;e<s.length-1;e++)a.push(i.table[s[e]].node);return t.fromArray(a.reduce((function(e,t){const r=e.length-1>=0?e[e.length-1]:null;return r&&r.mode===t.mode?(e[e.length-1].data+=t.data,e):(e.push(t),e)}),[]))},t.rawSplit=function(e){return t.fromArray(p(e,u.isKanjiModeEnabled()))}},242:(e,t)=>{let r;const n=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];t.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return 4*e+17},t.getSymbolTotalCodewords=function(e){return n[e]},t.getBCHDigit=function(e){let t=0;for(;0!==e;)t++,e>>>=1;return t},t.setToSJISFunction=function(e){if("function"!=typeof e)throw new Error('"toSJISFunc" is not a valid function.');r=e},t.isKanjiModeEnabled=function(){return void 0!==r},t.toSJIS=function(e){return r(e)}},114:(e,t)=>{t.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}},103:(e,t,r)=>{const n=r(242),o=r(393),i=r(908),s=r(910),a=r(114),c=n.getBCHDigit(7973);function u(e,t){return s.getCharCountIndicator(e,t)+4}function d(e,t){let r=0;return e.forEach((function(e){const n=u(e.mode,t);r+=n+e.getBitsLength()})),r}t.from=function(e,t){return a.isValid(e)?parseInt(e,10):t},t.getCapacity=function(e,t,r){if(!a.isValid(e))throw new Error("Invalid QR Code version");void 0===r&&(r=s.BYTE);const i=8*(n.getSymbolTotalCodewords(e)-o.getTotalCodewordsCount(e,t));if(r===s.MIXED)return i;const c=i-u(r,e);switch(r){case s.NUMERIC:return Math.floor(c/10*3);case s.ALPHANUMERIC:return Math.floor(c/11*2);case s.KANJI:return Math.floor(c/13);case s.BYTE:default:return Math.floor(c/8)}},t.getBestVersionForData=function(e,r){let n;const o=i.from(r,i.M);if(Array.isArray(e)){if(e.length>1)return function(e,r){for(let n=1;n<=40;n++)if(d(e,n)<=t.getCapacity(n,r,s.MIXED))return n}(e,o);if(0===e.length)return 1;n=e[0]}else n=e;return function(e,r,n){for(let o=1;o<=40;o++)if(r<=t.getCapacity(o,n,e))return o}(n.mode,n.getLength(),o)},t.getEncodedBits=function(e){if(!a.isValid(e)||e<7)throw new Error("Invalid QR Code version");let t=e<<12;for(;n.getBCHDigit(t)-c>=0;)t^=7973<<n.getBCHDigit(t)-c;return e<<12|t}},907:(e,t,r)=>{const n=r(653);t.render=function(e,t,r){let o=r,i=t;void 0!==o||t&&t.getContext||(o=t,t=void 0),t||(i=function(){try{return document.createElement("canvas")}catch(e){throw new Error("You need to specify a canvas element")}}()),o=n.getOptions(o);const s=n.getImageWidth(e.modules.size,o),a=i.getContext("2d"),c=a.createImageData(s,s);return n.qrToImageData(c.data,e,o),function(e,t,r){e.clearRect(0,0,t.width,t.height),t.style||(t.style={}),t.height=r,t.width=r,t.style.height=r+"px",t.style.width=r+"px"}(a,i,s),a.putImageData(c,0,0),i},t.renderToDataURL=function(e,r,n){let o=n;void 0!==o||r&&r.getContext||(o=r,r=void 0),o||(o={});const i=t.render(e,r,o),s=o.type||"image/png",a=o.rendererOpts||{};return i.toDataURL(s,a.quality)}},776:(e,t,r)=>{const n=r(653);function o(e,t){const r=e.a/255,n=t+'="'+e.hex+'"';return r<1?n+" "+t+'-opacity="'+r.toFixed(2).slice(1)+'"':n}function i(e,t,r){let n=e+t;return void 0!==r&&(n+=" "+r),n}t.render=function(e,t,r){const s=n.getOptions(t),a=e.modules.size,c=e.modules.data,u=a+2*s.margin,d=s.color.light.a?"<path "+o(s.color.light,"fill")+' d="M0 0h'+u+"v"+u+'H0z"/>':"",l="<path "+o(s.color.dark,"stroke")+' d="'+function(e,t,r){let n="",o=0,s=!1,a=0;for(let c=0;c<e.length;c++){const u=Math.floor(c%t),d=Math.floor(c/t);u||s||(s=!0),e[c]?(a++,c>0&&u>0&&e[c-1]||(n+=s?i("M",u+r,.5+d+r):i("m",o,0),o=0,s=!1),u+1<t&&e[c+1]||(n+=i("h",a),a=0)):o++}return n}(c,a,s.margin)+'"/>',h='viewBox="0 0 '+u+" "+u+'"',p='<svg xmlns="http://www.w3.org/2000/svg" '+(s.width?'width="'+s.width+'" height="'+s.width+'" ':"")+h+' shape-rendering="crispEdges">'+d+l+"</svg>\n";return"function"==typeof r&&r(null,p),p}},653:(e,t)=>{function r(e){if("number"==typeof e&&(e=e.toString()),"string"!=typeof e)throw new Error("Color should be defined as hex string");let t=e.slice().replace("#","").split("");if(t.length<3||5===t.length||t.length>8)throw new Error("Invalid hex color: "+e);3!==t.length&&4!==t.length||(t=Array.prototype.concat.apply([],t.map((function(e){return[e,e]})))),6===t.length&&t.push("F","F");const r=parseInt(t.join(""),16);return{r:r>>24&255,g:r>>16&255,b:r>>8&255,a:255&r,hex:"#"+t.slice(0,6).join("")}}t.getOptions=function(e){e||(e={}),e.color||(e.color={});const t=void 0===e.margin||null===e.margin||e.margin<0?4:e.margin,n=e.width&&e.width>=21?e.width:void 0,o=e.scale||4;return{width:n,scale:n?4:o,margin:t,color:{dark:r(e.color.dark||"#000000ff"),light:r(e.color.light||"#ffffffff")},type:e.type,rendererOpts:e.rendererOpts||{}}},t.getScale=function(e,t){return t.width&&t.width>=e+2*t.margin?t.width/(e+2*t.margin):t.scale},t.getImageWidth=function(e,r){const n=t.getScale(e,r);return Math.floor((e+2*r.margin)*n)},t.qrToImageData=function(e,r,n){const o=r.modules.size,i=r.modules.data,s=t.getScale(o,n),a=Math.floor((o+2*n.margin)*s),c=n.margin*s,u=[n.color.light,n.color.dark];for(let t=0;t<a;t++)for(let r=0;r<a;r++){let d=4*(t*a+r),l=n.color.light;t>=c&&r>=c&&t<a-c&&r<a-c&&(l=u[i[Math.floor((t-c)/s)*o+Math.floor((r-c)/s)]?1:0]),e[d++]=l.r,e[d++]=l.g,e[d++]=l.b,e[d]=l.a}}}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n={};return(()=>{"use strict";r.d(n,{Lk:()=>a,default:()=>Fe,nN:()=>o});const e=["redirect","popup"];function t(e){return window.btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function o(){var e;const r=new TextEncoder,n=new Uint8Array(32);window.crypto.getRandomValues(n);const o=t(n),i=null!==(e=window.crypto.webkitSubtle)&&void 0!==e?e:window.crypto.subtle;return Promise.resolve(i.digest("SHA-256",r.encode(o))).then((e=>t(new Uint8Array(e)))).then((e=>({code_verifier:o,code_challenge:e,code_challenge_method:"S256"})))}const i="@criipto/verify-js:pkce:state";function s(e){e.removeItem(i)}class a extends Error{constructor(e,t,r){super(e+(t?` (${t})`:"")),this.name="OAuth2Error",this.error=e,this.error_description=t,this.state=r}}const c=crypto,u=e=>e instanceof CryptoKey,d=new TextEncoder,l=new TextDecoder;const h=e=>{let t=e;t instanceof Uint8Array&&(t=l.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return(e=>{const t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r})(t)}catch(e){throw new TypeError("The input to be decoded is not correctly encoded.")}};class p extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,null===(t=Error.captureStackTrace)||void 0===t||t.call(Error,this,this.constructor)}}class f extends p{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}}class g extends p{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}}class w extends p{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}}class m extends p{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class y extends p{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}}class v extends p{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}class E extends p{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}}class A extends p{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}}class b extends p{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}class S extends p{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}}class _ extends p{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}c.getRandomValues.bind(c);const k=e=>u(e),P=["CryptoKey"];function C(){return"undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime}const T=async e=>{var t,r;const{algorithm:n,keyUsages:o}=function(e){let t,r;switch(e.kty){case"oct":switch(e.alg){case"HS256":case"HS384":case"HS512":t={name:"HMAC",hash:`SHA-${e.alg.slice(-3)}`},r=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":throw new m(`${e.alg} keys cannot be imported as CryptoKey instances`);case"A128GCM":case"A192GCM":case"A256GCM":case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":t={name:"AES-GCM"},r=["encrypt","decrypt"];break;case"A128KW":case"A192KW":case"A256KW":t={name:"AES-KW"},r=["wrapKey","unwrapKey"];break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":t={name:"PBKDF2"},r=["deriveBits"];break;default:throw new m('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new m('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new m('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case C()&&"OKP":if("EdDSA"!==e.alg)throw new m('Invalid or unsupported JWK "alg" (Algorithm) Parameter value');if("Ed25519"!==e.crv)throw new m('Invalid or unsupported JWK "alg" (Algorithm) Parameter value');t={name:"NODE-ED25519",namedCurve:"NODE-ED25519"},r=e.d?["sign"]:["verify"];break;case"OKP":switch(e.alg){case"EdDSA":t={name:e.crv},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new m('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new m('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}(e),i=[n,null!==(t=e.ext)&&void 0!==t&&t,null!==(r=e.key_ops)&&void 0!==r?r:o];if("PBKDF2"===n.name)return c.subtle.importKey("raw",h(e.k),...i);const s={...e};return delete s.alg,delete s.use,c.subtle.importKey("jwk",s,...i)};function I(e){if("object"!=typeof(t=e)||null===t||"[object Object]"!==Object.prototype.toString.call(e))return!1;var t;if(null===Object.getPrototypeOf(e))return!0;let r=e;for(;null!==Object.getPrototypeOf(r);)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(e)===r}function R(e,t,...r){if(r.length>2){const t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor&&t.constructor.name&&(e+=` Received an instance of ${t.constructor.name}`),e}const O=(e,...t)=>R("Key must be ",e,...t);function M(e,t,...r){return R(`Key for the ${e} algorithm must be `,t,...r)}function x(e,t="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function U(e,t){return e.name===t}function K(e){return parseInt(e.name.slice(4),10)}function N(e,t,...r){switch(t){case"HS256":case"HS384":case"HS512":{if(!U(e.algorithm,"HMAC"))throw x("HMAC");const r=parseInt(t.slice(2),10);if(K(e.algorithm.hash)!==r)throw x(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!U(e.algorithm,"RSASSA-PKCS1-v1_5"))throw x("RSASSA-PKCS1-v1_5");const r=parseInt(t.slice(2),10);if(K(e.algorithm.hash)!==r)throw x(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!U(e.algorithm,"RSA-PSS"))throw x("RSA-PSS");const r=parseInt(t.slice(2),10);if(K(e.algorithm.hash)!==r)throw x(`SHA-${r}`,"algorithm.hash");break}case C()&&"EdDSA":if(!U(e.algorithm,"NODE-ED25519"))throw x("NODE-ED25519");break;case"EdDSA":if("Ed25519"!==e.algorithm.name&&"Ed448"!==e.algorithm.name)throw x("Ed25519 or Ed448");break;case"ES256":case"ES384":case"ES512":{if(!U(e.algorithm,"ECDSA"))throw x("ECDSA");const r=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}(t);if(e.algorithm.namedCurve!==r)throw x(r,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}!function(e,t){if(t.length&&!t.some((t=>e.usages.includes(t)))){let e="CryptoKey does not support this operation, its usages must include ";if(t.length>2){const r=t.pop();e+=`one of ${t.join(", ")}, or ${r}.`}else 2===t.length?e+=`one of ${t[0]} or ${t[1]}.`:e+=`${t[0]}.`;throw new TypeError(e)}}(e,r)}Symbol();async function B(e,t,r){if(e instanceof Uint8Array&&(e=l.decode(e)),"string"!=typeof e)throw new y("Compact JWS must be a string or Uint8Array");const{0:n,1:o,2:i,length:s}=e.split(".");if(3!==s)throw new y("Invalid Compact JWS");const a=await async function(e,t,r){var n;if(!I(e))throw new y("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new y('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new y("JWS Protected Header incorrect type");if(void 0===e.payload)throw new y("JWS Payload missing");if("string"!=typeof e.signature)throw new y("JWS Signature missing or incorrect type");if(void 0!==e.header&&!I(e.header))throw new y("JWS Unprotected Header incorrect type");let o={};if(e.protected)try{const t=h(e.protected);o=JSON.parse(l.decode(t))}catch(e){throw new y("JWS Protected Header is invalid")}if(!((...e)=>{const t=e.filter(Boolean);if(0===t.length||1===t.length)return!0;let r;for(const e of t){const t=Object.keys(e);if(r&&0!==r.size)for(const e of t){if(r.has(e))return!1;r.add(e)}else r=new Set(t)}return!0})(o,e.header))throw new y("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const i={...o,...e.header};let s=!0;if(function(e,t,r,n,o){if(void 0!==o.crit&&void 0===n.crit)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||void 0===n.crit)return new Set;if(!Array.isArray(n.crit)||0===n.crit.length||n.crit.some((e=>"string"!=typeof e||0===e.length)))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let i;i=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t;for(const t of n.crit){if(!i.has(t))throw new m(`Extension Header Parameter "${t}" is not recognized`);if(void 0===o[t])throw new e(`Extension Header Parameter "${t}" is missing`);if(i.get(t)&&void 0===n[t])throw new e(`Extension Header Parameter "${t}" MUST be integrity protected`)}return new Set(n.crit)}(y,new Map([["b64",!0]]),null==r?void 0:r.crit,o,i).has("b64")&&(s=o.b64,"boolean"!=typeof s))throw new y('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:a}=i;if("string"!=typeof a||!a)throw new y('JWS "alg" (Algorithm) Header Parameter missing or invalid');const p=r&&((e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some((e=>"string"!=typeof e))))throw new TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)})("algorithms",r.algorithms);if(p&&!p.has(a))throw new w('"alg" (Algorithm) Header Parameter not allowed');if(s){if("string"!=typeof e.payload)throw new y("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new y("JWS Payload must be a string or an Uint8Array instance");let f=!1;"function"==typeof t&&(t=await t(o,e),f=!0),((e,t,r)=>{e.startsWith("HS")||"dir"===e||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)?((e,t)=>{if(!(t instanceof Uint8Array)){if(!k(t))throw new TypeError(M(e,t,...P,"Uint8Array"));if("secret"!==t.type)throw new TypeError(`${P.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}})(e,t):((e,t,r)=>{if(!k(t))throw new TypeError(M(e,t,...P));if("secret"===t.type)throw new TypeError(`${P.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw new TypeError(`${P.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw new TypeError(`${P.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw new TypeError(`${P.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw new TypeError(`${P.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)})(e,t,r)})(a,t,"verify");const g=function(...e){const t=e.reduce(((e,{length:t})=>e+t),0),r=new Uint8Array(t);let n=0;return e.forEach((e=>{r.set(e,n),n+=e.length})),r}(d.encode(null!==(n=e.protected)&&void 0!==n?n:""),d.encode("."),"string"==typeof e.payload?d.encode(e.payload):e.payload),v=h(e.signature);if(!await(async(e,t,r,n)=>{const o=await function(e,t,r){if(u(t))return N(t,e,r),t;if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError(O(t,...P));return c.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[r])}throw new TypeError(O(t,...P,"Uint8Array"))}(e,t,"verify");((e,t)=>{if(e.startsWith("RS")||e.startsWith("PS")){const{modulusLength:r}=t.algorithm;if("number"!=typeof r||r<2048)throw new TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}})(e,o);const i=function(e,t){const r=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:e.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case C()&&"EdDSA":const{namedCurve:n}=t;return{name:n,namedCurve:n};case"EdDSA":return{name:t.name};default:throw new m(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}(e,o.algorithm);try{return await c.subtle.verify(i,o,r,n)}catch(e){return!1}})(a,t,v,g))throw new _;let E;E=s?h(e.payload):"string"==typeof e.payload?d.encode(e.payload):e.payload;const A={payload:E};return void 0!==e.protected&&(A.protectedHeader=o),void 0!==e.header&&(A.unprotectedHeader=e.header),f?{...A,key:t}:A}({payload:o,protected:n,signature:i},t,r),p={payload:a.payload,protectedHeader:a.protectedHeader};return"function"==typeof t?{...p,key:a.key}:p}const D=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i,L=e=>{const t=D.exec(e);if(!t)throw new TypeError("Invalid time period format");const r=parseFloat(t[1]);switch(t[2].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(r);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(60*r);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(3600*r);case"day":case"days":case"d":return Math.round(86400*r);case"week":case"weeks":case"w":return Math.round(604800*r);default:return Math.round(31557600*r)}},H=e=>e.toLowerCase().replace(/^application\//,""),j=(e,t,r={})=>{const{typ:n}=r;if(n&&("string"!=typeof e.typ||H(e.typ)!==H(n)))throw new f('unexpected "typ" JWT header value',"typ","check_failed");let o;try{o=JSON.parse(l.decode(t))}catch(e){}if(!I(o))throw new v("JWT Claims Set must be a top-level JSON object");const{issuer:i}=r;if(i&&!(Array.isArray(i)?i:[i]).includes(o.iss))throw new f('unexpected "iss" claim value',"iss","check_failed");const{subject:s}=r;if(s&&o.sub!==s)throw new f('unexpected "sub" claim value',"sub","check_failed");const{audience:a}=r;if(a&&(u="string"==typeof a?[a]:a,!("string"==typeof(c=o.aud)?u.includes(c):Array.isArray(c)&&u.some(Set.prototype.has.bind(new Set(c))))))throw new f('unexpected "aud" claim value',"aud","check_failed");var c,u;let d;switch(typeof r.clockTolerance){case"string":d=L(r.clockTolerance);break;case"number":d=r.clockTolerance;break;case"undefined":d=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:h}=r,p=(w=h||new Date,Math.floor(w.getTime()/1e3));var w;if((void 0!==o.iat||r.maxTokenAge)&&"number"!=typeof o.iat)throw new f('"iat" claim must be a number',"iat","invalid");if(void 0!==o.nbf){if("number"!=typeof o.nbf)throw new f('"nbf" claim must be a number',"nbf","invalid");if(o.nbf>p+d)throw new f('"nbf" claim timestamp check failed',"nbf","check_failed")}if(void 0!==o.exp){if("number"!=typeof o.exp)throw new f('"exp" claim must be a number',"exp","invalid");if(o.exp<=p-d)throw new g('"exp" claim timestamp check failed',"exp","check_failed")}if(r.maxTokenAge){const e=p-o.iat;if(e-d>("number"==typeof r.maxTokenAge?r.maxTokenAge:L(r.maxTokenAge)))throw new g('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(e<0-d)throw new f('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return o};function W(e){return e&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(J)}function J(e){return I(e)}class ${constructor(e){if(this._cached=new WeakMap,!W(e))throw new E("JSON Web Key Set malformed");var t;this._jwks=(t=e,"function"==typeof structuredClone?structuredClone(t):JSON.parse(JSON.stringify(t)))}async getKey(e,t){const{alg:r,kid:n}={...e,...t.header},o=function(e){switch("string"==typeof e&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new m('Unsupported "alg" value for a JSON Web Key Set')}}(r),i=this._jwks.keys.filter((e=>{let t=o===e.kty;if(t&&"string"==typeof n&&(t=n===e.kid),t&&"string"==typeof e.alg&&(t=r===e.alg),t&&"string"==typeof e.use&&(t="sig"===e.use),t&&Array.isArray(e.key_ops)&&(t=e.key_ops.includes("verify")),t&&"EdDSA"===r&&(t="Ed25519"===e.crv||"Ed448"===e.crv),t)switch(r){case"ES256":t="P-256"===e.crv;break;case"ES256K":t="secp256k1"===e.crv;break;case"ES384":t="P-384"===e.crv;break;case"ES512":t="P-521"===e.crv}return t})),{0:s,length:a}=i;if(0===a)throw new A;if(1!==a)throw new b;const c=this._cached.get(s)||this._cached.set(s,{}).get(s);if(void 0===c[r]){const e=await async function(e,t,r){var n;if(!I(e))throw new TypeError("JWK must be an object");if(t||(t=e.alg),"string"!=typeof t||!t)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');switch(e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw new TypeError('missing "k" (Key Value) Parameter value');return null!=r||(r=!0!==e.ext),r?T({...e,alg:t,ext:null!==(n=e.ext)&&void 0!==n&&n}):h(e.k);case"RSA":if(void 0!==e.oth)throw new m('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return T({...e,alg:t});default:throw new m('Unsupported "kty" (Key Type) Parameter value')}}({...s,ext:!0},r);if(e instanceof Uint8Array||"public"!==e.type)throw new E("JSON Web Key Set members must be public keys");c[r]=e}return c[r]}}class z extends ${constructor(e,t){if(super({keys:[]}),this._jwks=void 0,!(e instanceof URL))throw new TypeError("url must be an instance of URL");this._url=new URL(e.href),this._options={agent:null==t?void 0:t.agent,headers:null==t?void 0:t.headers},this._timeoutDuration="number"==typeof(null==t?void 0:t.timeoutDuration)?null==t?void 0:t.timeoutDuration:5e3,this._cooldownDuration="number"==typeof(null==t?void 0:t.cooldownDuration)?null==t?void 0:t.cooldownDuration:3e4,this._cacheMaxAge="number"==typeof(null==t?void 0:t.cacheMaxAge)?null==t?void 0:t.cacheMaxAge:6e5}coolingDown(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cooldownDuration}fresh(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cacheMaxAge}async getKey(e,t){this._jwks&&this.fresh()||await this.reload();try{return await super.getKey(e,t)}catch(r){if(r instanceof A&&!1===this.coolingDown())return await this.reload(),super.getKey(e,t);throw r}}async reload(){if(this._pendingFetch&&C())return new Promise((e=>{const t=()=>{void 0===this._pendingFetch?e():setTimeout(t,5)};t()}));this._pendingFetch||(this._pendingFetch=(async(e,t,r)=>{let n,o,i=!1;"function"==typeof AbortController&&(n=new AbortController,o=setTimeout((()=>{i=!0,n.abort()}),t));const s=await fetch(e.href,{signal:n?n.signal:void 0,redirect:"manual",headers:r.headers}).catch((e=>{if(i)throw new S;throw e}));if(void 0!==o&&clearTimeout(o),200!==s.status)throw new p("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await s.json()}catch(e){throw new p("Failed to parse the JSON Web Key Set HTTP response as JSON")}})(this._url,this._timeoutDuration,this._options).then((e=>{if(!W(e))throw new E("JSON Web Key Set malformed");this._jwks={keys:e.keys},this._jwksTimestamp=Date.now(),this._pendingFetch=void 0})).catch((e=>{throw this._pendingFetch=void 0,e}))),await this._pendingFetch}}class F{}const V=class extends F{constructor(e,t){super(),this.authority=e,this.clientID=t}fetchMetadata(){return window.fetch(`${this.authority}/.well-known/openid-configuration?client_id=${this.clientID}`).then((e=>e.json())).then((e=>(Object.assign(this,e),this)))}};class q{}const Y=class extends q{constructor(e,t){super(),this.authority=e,this.clientID=t}fetchMetadata(){return window.fetch(`${this.authority}/.well-known/criipto-configuration?client_id=${this.clientID}`).then((e=>e.json())).then((e=>(Object.assign(this,e),this.client=this.clients.find((e=>e.client_id===this.clientID)),this)))}};function G(e){return e&&e.length?((e.startsWith("?")||e.startsWith("#"))&&(e=e.replace(/^(\?|\#)/,"")),e.split("&").reduce(((e,t)=>{const r=t.split("=");return e[r[0]]=decodeURIComponent(r[1]),e}),{})):{}}function Q(e){return function(e){return Object.assign(Object.assign({},G(e.search)),G(e.hash))}(e)}function X(e){return G(new URL(e).search)}const Z="CRIIPTO_AUTHORIZE_RESPONSE",ee="criipto_popup_backdrop",te="criipto_popup_backdrop_button_open",re="criipto_popup_backdrop_button_close";class ne{constructor(e){this.criiptoAuth=e,this.store=this.criiptoAuth.store}authorize(e){var t,r,n,s,a;return r=this,n=void 0,a=function*(){const r=e.redirectUri||this.criiptoAuth.options.redirectUri,n=null!==(t=e.responseType)&&void 0!==t?t:"id_token",s=yield e.pkce?Promise.resolve(e.pkce):"id_token"===n?o():Promise.resolve(void 0);var a,c;a=this.store,c=s&&"code_verifier"in s?{response_type:"id_token",redirect_uri:r,pkce_code_verifier:s.code_verifier}:{response_type:"code",redirect_uri:r},a.setItem(i,JSON.stringify(c));const u=yield this.criiptoAuth.buildAuthorizeUrl(this.criiptoAuth.buildAuthorizeParams(Object.assign(Object.assign({},e),{responseMode:"query",responseType:"code",pkce:s})));window.location.href=u},new((s=void 0)||(s=Promise))((function(e,t){function o(e){try{c(a.next(e))}catch(e){t(e)}}function i(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof s?r:new s((function(e){e(r)}))).then(o,i)}c((a=a.apply(r,n||[])).next())}))}match(){const e=Q(window.location);if(!e.code&&!e.error&&!e.id_token)return Promise.resolve(null);if(e.error)return Promise.reject(new a(e.error,e.error_description,e.state));if(e.id_token)return Promise.resolve(e);const t=function(e){const t=e.getItem(i);return t?JSON.parse(t):null}(this.store);return t?this.criiptoAuth.processResponse(e,"id_token"===t.response_type?{code_verifier:t.pkce_code_verifier,redirect_uri:t.redirect_uri}:void 0).then((e=>(e&&s(this.store),e))).catch((e=>(s(this.store),Promise.reject(e)))):Promise.reject(new Error("No redirect state available"))}hasMatch(){const e=Q(window.location);return!!(e.code||e.error||e.id_token)}}class oe{constructor(e){this.criiptoAuth=e,this.backdrop=new ue(this)}open(e,t){var r,n,o,i,s,a;let{width:c,height:u}=t;c=c||330,u=u||600;const d=null!==(r=window.screenLeft)&&void 0!==r?r:window.screenX,l=null!==(n=window.screenTop)&&void 0!==n?n:window.screenY,h=null!==(i=null!==(o=window.innerWidth)&&void 0!==o?o:document.documentElement.clientWidth)&&void 0!==i?i:screen.width,p=null!==(a=null!==(s=window.innerHeight)&&void 0!==s?s:document.documentElement.clientHeight)&&void 0!==a?a:screen.height,f=h/window.screen.availWidth,g=`width=${c},height=${u},top=${(p-u)/2/f+l},left=${(h-c)/2/f+d}`;return this.window=window.open(e,"CRIIPTO_POPUP_ID",g),!1!==t.backdrop&&(this._latestParams=t,this._latestUrl=e,this.backdrop.render(t)),this.window}listen(){return new Promise(((e,t)=>{const r=t=>{if(t.source!==this.window&&t.origin!==`https://${this.criiptoAuth.domain}`)return;const n=t.data.startsWith(Z)?Z:null;if(n===Z){const o=n===Z?JSON.parse(t.data.replace(Z,"")):null;o&&(o.code||o.id_token||o.error)&&(window.removeEventListener("message",r),this.window.close(),e(o))}else t.data&&(t.data.includes("code=")||t.data.includes("id_token=")||t.data.includes("error="))&&(window.removeEventListener("message",r),this.window.close(),e(X(t.data)))};window.addEventListener("message",r)})).finally((()=>{this.backdrop.remove()}))}buildAuthorizeUrl(e){const t=this.criiptoAuth.buildAuthorizeParams(Object.assign(Object.assign({},e),{responseMode:"post_message"}));return this.criiptoAuth.buildAuthorizeUrl(t).then((e=>({url:e,params:t})))}trigger(e){return this.buildAuthorizeUrl(e).then((({url:t,params:r})=>(this.open(t,e),this.listen().then((e=>this.criiptoAuth.processResponse(e,r.pkce&&"code_verifier"in r.pkce?{code_verifier:r.pkce.code_verifier,redirect_uri:r.redirectUri}:void 0).then((e=>e))))))).finally((()=>{!1!==e.backdrop&&this.backdrop.remove()}))}authorize(e){var t,r,n,i,s;return r=this,n=void 0,s=function*(){const r=null!==(t=e.responseType)&&void 0!==t?t:"id_token",n=yield e.pkce?Promise.resolve(e.pkce):"id_token"===r?o():Promise.resolve(void 0);return this.trigger(Object.assign(Object.assign({},e),{responseType:"code",pkce:n}))},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof i?r:new i((function(e){e(r)}))).then(o,a)}c((s=s.apply(r,n||[])).next())}))}close(){this.window.close()}callback(e){if(!e)throw new Error("popup.callback required argument origin");const t=Q(window.location);window.opener.postMessage(Z+JSON.stringify(t),e),window.close()}}const ie=`\n<div class="criipto-auth-popup-backdrop-background"></div>\n<div class="criipto-auth-popup-backdrop-content">\n  <p>Don't see the login popup?</p>\n  <button id="${te}">Reopen popup</button>\n  <button id="${re}">Cancel</button>\n</div>\n`,se=`\n<div class="criipto-auth-popup-backdrop-background"></div>\n<div class="criipto-auth-popup-backdrop-content">\n  <p>Kan du ikke se pop-uppen?</p>\n  <button id="${te}">Åben popup</button>\n  <button id="${re}">Fortryd</button>\n</div>\n`,ae=`\n<div class="criipto-auth-popup-backdrop-background"></div>\n<div class="criipto-auth-popup-backdrop-content">\n  <p>Ser du inte inloggningspopupen?</p>\n  <button id="${te}">Öppna popup igen</button>\n  <button id="${re}">Avbryt</button>\n</div>\n`,ce=`\n<div class="criipto-auth-popup-backdrop-background"></div>\n<div class="criipto-auth-popup-backdrop-content">\n  <p>Ser du ikke popup-dialogboksen for pålogging?</p>\n  <button id="${te}">Åpne popup på nytt</button>\n  <button id="${re}">Avbryt</button>\n</div>\n`;class ue{constructor(e){this.template=null,this.popup=e,this.enabled=!0,this.handleOpen=this.handleOpen.bind(this),this.handleCancel=this.handleCancel.bind(this)}render(e){var t,r,n;const o=document.getElementById(ee),i=(null!==(t=this.template)&&void 0!==t?t:"da"==e.uiLocales)?se:"se"==e.uiLocales||"sv"==e.uiLocales?ae:"nb"==e.uiLocales?ce:ie;if(!o){const e=document.createElement("div");e.id=ee,e.className="criipto-auth-popup-backdrop",e.innerHTML=i,document.body.appendChild(e),null===(r=document.getElementById(te))||void 0===r||r.addEventListener("click",this.handleOpen),null===(n=document.getElementById(re))||void 0===n||n.addEventListener("click",this.handleCancel)}}handleOpen(){this.popup.open(this.popup._latestUrl,this.popup._latestParams)}handleCancel(){this.remove(),this.popup.close()}remove(){const e=document.getElementById(ee);e&&document.body.removeChild(e)}}var de=r(592),le=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};class he{constructor(e){if(this.URL=e,!e.includes("{id}"))throw new Error("Expected URL to include {id} template arg.")}get(e){return le(this,void 0,void 0,(function*(){const t=this.URL.replace("{id}",e),r=yield fetch(t);if(r.ok)return yield r.json();if(404===r.status)return null;const n=yield r.text();throw new Error(n)}))}save(e,t){return le(this,void 0,void 0,(function*(){const r=this.URL.replace("{id}",e),n=yield fetch(r,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});if(n.ok)return;const o=yield n.text();throw new Error(o)}))}delete(e){return le(this,void 0,void 0,(function*(){const t=this.URL.replace("{id}",e),r=yield fetch(t,{method:"DELETE"});if(r.ok)return;const n=yield r.text();throw new Error(n)}))}}var pe=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};function fe(e){return"ACK"===e.type}function ge(e){let t=e.toString(16);return 1==t.length?`0${t}`:t}function we(){if(void 0===crypto.randomUUID){const e=new Uint8Array(16);return window.crypto.getRandomValues(e),Array.from(e,ge).join("")}return crypto.randomUUID().replace(/-/g,"")}function me(e){let t="",r=new Uint8Array(e),n=r.byteLength;for(let e=0;e<n;e++)t+=String.fromCharCode(r[e]);return window.btoa(t)}function ye(e){const t=window.atob(e),r=new ArrayBuffer(t.length),n=new Uint8Array(r);for(let e=0,r=t.length;e<r;e++)n[e]=t.charCodeAt(e);return r}var ve,Ee,Ae,be,Se,_e,ke,Pe,Ce,Te,Ie=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},Re=function(e,t,r,n,o){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,r):o?o.value=r:t.set(e,r),r},Oe=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};const Me=Math.floor(12);class xe extends Error{constructor(){super("Promise cancelled"),Object.setPrototypeOf(this,xe.prototype)}}class Ue extends a{constructor(e,t,r){super(e,t,r)}}class Ke extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ke.prototype)}}class Ne extends Promise{constructor(e){let t,r;super(((n,o)=>{e(n,o),t=n,r=o})),this.cancelled=!1,this.acknowledged=!1,ve.set(this,void 0),Ee.set(this,void 0),Re(this,ve,r,"f")}cancel(){this.cancelled=!0,Oe(this,ve,"f").call(this,new xe),this.onCancel&&this.onCancel()}acknowledge(){this.acknowledged=!0,this.onAcknowledged&&this.onAcknowledged()}}ve=new WeakMap,Ee=new WeakMap;class Be{constructor(e){Ae.add(this),be.set(this,void 0),Se.set(this,void 0),_e.set(this,void 0),ke.set(this,void 0),Pe.set(this,void 0),this.criiptoAuth=e}setup(){return Ie(this,void 0,void 0,(function*(){return Oe(this,ke,"f")||Re(this,ke,Promise.resolve().then((()=>Ie(this,void 0,void 0,(function*(){Re(this,Pe,new Image,"f"),Oe(this,Pe,"f").src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGgAAABoCAYAAAAdHLWhAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAEqSURBVHgB7d2rDQIBEEXRgYCkDwT9YZAICsTQBpqETxPs3eQcMQ3cPD0zpG1+5/01JG2HNIHiBIoTKE6gOIHiBIoTKE6gOIHiBIoTKE6gOIHiBIoTKE6gOIHiBIoTKE6gOIHiBIoTKE6gOIHiBIoTKE6gOIHiBIoTKE6gOIHiBIoTKE6gOIHiBIrbzUJul+c87q9Zk+NpP+frYf7JguIEihMoTqA4geIEihMoTqA4geIEihMoTqA4geIEihMoTqA4geIEihMoTqA4geIEihMozv+gOAuKEyhOoDiB4gSKEyhOoDiB4gSKEyhOoDiB4gSKEyhOoDiB4gSKEyhOoDiB4gSKEyhOoDiB4gSKEyhOoDiB4gSKEyhOoDiB4gSKEyhOoDiB4gSKEyjuA1QSDsex8ZN1AAAAAElFTkSuQmCC",Re(this,be,we(),"f");const e=yield this.criiptoAuth.fetchCriiptoConfiguration();return Re(this,Se,new he(e.csdc_session_url),"f"),Re(this,_e,new WebSocket(`${e.csdc_wss_url}?clientId=${Oe(this,be,"f")}`),"f"),yield new Promise(((e,t)=>{Oe(this,_e,"f").addEventListener("open",e)})),e})))),"f"),yield Oe(this,ke,"f")}))}authorize(e,t){const r=new Ne(((n,i)=>Ie(this,void 0,void 0,(function*(){var s,c;const u=Oe(this,Ae,"m",Ce).call(this,e),d=null!==(s=null==t?void 0:t.responseType)&&void 0!==s?s:"id_token";let l,h=null,p=[];const f=()=>{l&&clearInterval(l),u.parentElement===e&&e.removeChild(u)};try{const e=yield this.setup();if(!e.client.qr_enabled)throw new Ke("QR is not enabled for this Criipto Application. Please go to https://dashboard.criipto.com and enable it.");const s=null!==(c=e.client.qr_intermediary_url)&&void 0!==c?c:e.qr_intermediary_url,g=s.replace("{id}",""),w=!1!==e.client.qr_branding,m=yield(null==t?void 0:t.pkce)?Promise.resolve(t.pkce):"id_token"===d?o():Promise.resolve(void 0),y=null==t?void 0:t.state,v=yield this.criiptoAuth.buildAuthorizeUrl(this.criiptoAuth.buildAuthorizeParams(Object.assign(Object.assign({},t),{pkce:m,redirectUri:g,responseMode:"query",responseType:"code",prompt:"login"}))),E=()=>Ie(this,void 0,void 0,(function*(){var e;if(r.acknowledged)return void(l&&clearInterval(l));if(r.cancelled)return void f();const n=yield Oe(this,Ae,"m",Te).call(this,{action:{authorize:v}});p=[n].concat(p).slice(0,Me);const o=s.replace("{id}",n.id),i=yield de.toCanvas(o,{errorCorrectionLevel:"low",scale:10,width:u.width,margin:null!==(e=null==t?void 0:t.margin)&&void 0!==e?e:4}),a=.15*u.width,c=.15*u.height,d=u.getContext("2d");d.drawImage(i,0,0),w&&(d.imageSmoothingEnabled=!1,d.drawImage(Oe(this,Pe,"f"),(u.width-a)/2,(u.width-c)/2,a,c))}));yield E(),l=setInterval((()=>{E()}),2500);const A=e=>Ie(this,void 0,void 0,(function*(){var t;if(!r.cancelled)if(r.acknowledged){if(h){const r=yield crypto.subtle.decrypt({name:h.keyPair.algorithm},h.keyPair.privateKey,ye(e.data)).catch((e=>null));if(!r)return;const o=JSON.parse(atob(me(r)));!function(e){return"OAUTH2_CODE"===e.type}(o)?function(e){return"CANCEL"===e.type}(o)?(i(new Ue("access_denied","User cancelled login.",y)),f()):function(e){return"OAUTH2_ERROR"===e.type}(o)&&(i(new a(o.error,null!==(t=o.error_description)&&void 0!==t?t:void 0,y)),Oe(this,_e,"f").removeEventListener("message",A),f()):(f(),yield this.criiptoAuth.processResponse({code:o.code,state:y},m&&"code_verifier"in m?{redirect_uri:g,code_verifier:m.code_verifier}:void 0).then((e=>{n(e),Oe(this,_e,"f").removeEventListener("message",A)})).catch((e=>{i(e),Oe(this,_e,"f").removeEventListener("message",A)})))}}else for(const t of p){const n=yield crypto.subtle.decrypt({name:t.keyPair.algorithm},t.keyPair.privateKey,ye(e.data)).catch((e=>null));n&&(fe(JSON.parse(atob(me(n))))&&(p=[t],h=t,r.acknowledge()))}}));Oe(this,_e,"f").addEventListener("message",A),r.onCancel=()=>{Oe(this,_e,"f").removeEventListener("message",A),f()}}catch(e){f(),i(e)}}))));return r}}be=new WeakMap,Se=new WeakMap,_e=new WeakMap,ke=new WeakMap,Pe=new WeakMap,Ae=new WeakSet,Ce=function(e){const t=getComputedStyle(e),r=document.createElement("canvas");r.setAttribute("data-criipto-id","criiptoqrcanvas"),r.width=e.clientWidth-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight),r.height=r.width;const n=e.querySelector('[data-criipto-id="criiptoqrcanvas"]');return n&&e.removeChild(n),e.appendChild(r),r},Te=function(e){return Ie(this,void 0,void 0,(function*(){const t=yield this.setup(),r=we(),n=yield function(){return pe(this,void 0,void 0,(function*(){const e={name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-512"},t=yield crypto.subtle.generateKey(e,!0,["encrypt","decrypt"]);return{algorithm:"RSA-OAEP",privateKey:t.privateKey,publicKey:t.publicKey}}))}(),o=yield function(e){return pe(this,void 0,void 0,(function*(){return me(yield crypto.subtle.exportKey("spki",e.publicKey))}))}(n);return yield Oe(this,Se,"f").save(r,Object.assign({csdc_algo:"RSA-OAEP",csdc_initiator_id:Oe(this,be,"f"),csdc_wss:t.csdc_wss_url,csdc_key:o},e)),{id:r,keyPair:n}}))};class De{constructor(e){this.criiptoAuth=e}open(e){const t=document.createElement("iframe");return t.style.width="0px",t.style.height="0px",t.style.visibility="hidden",t.src=e,document.body.appendChild(t),t}remove(e){(null==e?void 0:e.parentNode)===document.body&&document.body.removeChild(e)}listen(e){return new Promise(((t,r)=>{const n=r=>{(r.source===e.contentWindow||r.origin===`https://${this.criiptoAuth.domain}`)&&r.data&&(r.data.includes("code=")||r.data.includes("id_token=")||r.data.includes("error="))&&(window.removeEventListener("message",n),this.remove(e),t(X(r.data)))};window.addEventListener("message",n)}))}authorize(e){var t,r,n,i,s;return r=this,n=void 0,s=function*(){const r=e.redirectUri||this.criiptoAuth.options.redirectUri,n=null!==(t=e.responseType)&&void 0!==t?t:"id_token",i=yield"id_token"===n?o():Promise.resolve(void 0),s=yield this.criiptoAuth.buildAuthorizeUrl(this.criiptoAuth.buildAuthorizeParams(Object.assign(Object.assign({},e),{responseMode:"post_message",responseType:"code",pkce:i,prompt:"none"}))),a=e.timeout||1e4,c=this.open(s);return Promise.race([new Promise(((e,t)=>{setTimeout((()=>{t("Timed out")}),a)})),this.listen(c).then((e=>this.criiptoAuth.processResponse(e,i&&"code_verifier"in i?{code_verifier:i.code_verifier,redirect_uri:r}:void 0).then((e=>e))))]).finally((()=>this.remove(c)))},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof i?r:new i((function(e){e(r)}))).then(o,a)}c((s=s.apply(r,n||[])).next())}))}}var Le,He,je,We,Je=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},$e=function(e,t,r,n,o){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,r):o?o.value=r:t.set(e,r),r},ze=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};Le=new WeakMap,He=new WeakMap,je=new WeakMap,We=new WeakMap;const Fe=class{constructor(e){var t;if(Le.set(this,void 0),He.set(this,void 0),je.set(this,void 0),We.set(this,void 0),!e.domain||!e.clientID||!e.store)throw new Error("new criipto.Auth({domain, clientID, store}) required");this.options=e,this.domain=e.domain,this.clientID=e.clientID,this.store=e.store,this.popup=new oe(this),this.redirect=new ne(this),this.qr=new Be(this),this.silent=new De(this);const r=null!==(t=e.protocol)&&void 0!==t?t:"https";this._openIdConfiguration=new V(`${r}://${this.domain}`,this.clientID),$e(this,je,new Y(`${r}://${this.domain}`,this.clientID),"f")}_setup(){return ze(this,Le,"f")||$e(this,Le,this._openIdConfiguration.fetchMetadata().then((e=>{var t;return $e(this,We,(t=new URL(e.jwks_uri),z.prototype.getKey.bind(new z(t,undefined))),"f"),e})),"f"),ze(this,Le,"f")}fetchOpenIDConfiguration(){return this._setup().then((()=>this._openIdConfiguration))}fetchCriiptoConfiguration(){return ze(this,He,"f")||$e(this,He,ze(this,je,"f").fetchMetadata(),"f"),ze(this,He,"f")}logout(e){return Je(this,void 0,void 0,(function*(){const{redirectUri:t}=e,r=`${(yield this.fetchOpenIDConfiguration()).end_session_endpoint}?post_logout_redirect_uri=${encodeURIComponent(t)}`;window.location.href=r}))}authorize(e){return this.redirect.authorize(e)}checkSession(e){return Je(this,void 0,void 0,(function*(){return this.silent.authorize(e)}))}authorizeResponsive(t){let r;for(let[n,o]of Object.entries(t)){if(!e.includes(o.via))throw new Error("Unknown match.via");if(window.matchMedia(n).matches){r=o;break}}if(void 0===r)throw new Error("No media queries matched");const{via:n}=r,o=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r}(r,["via"]);if("redirect"===n)return this.redirect.authorize(o);if("popup"===n)return this.popup.authorize(o);throw new Error("Invalid media query")}buildAuthorizeUrl(e){return this._setup().then((()=>{var t,r,n;const o=this._openIdConfiguration.response_modes_supported.concat(["json","post_message"]);if(!o.includes(e.responseMode))throw new Error(`responseMode must be one of ${o.join(",")}`);if(!this._openIdConfiguration.response_types_supported.includes(e.responseType))throw new Error(`responseType must be one of ${this._openIdConfiguration.response_types_supported.join(",")}`);const i=e.acrValues?Array.isArray(e.acrValues)?e.acrValues:e.acrValues.includes(" ")?e.acrValues.split(" "):e.acrValues:void 0;if(!e.redirectUri)throw new Error("redirectUri must be defined");const s=new URL(this._openIdConfiguration.authorization_endpoint);if(s.searchParams.append("scope",e.scope),s.searchParams.append("client_id",this.clientID),i&&s.searchParams.append("acr_values",Array.isArray(i)?i.join(" "):i),s.searchParams.append("redirect_uri",e.redirectUri),s.searchParams.append("response_type",e.responseType),s.searchParams.append("response_mode",e.responseMode),e.pkce&&(s.searchParams.append("code_challenge",e.pkce.code_challenge),s.searchParams.append("code_challenge_method",e.pkce.code_challenge_method)),e.state&&s.searchParams.append("state",e.state),e.nonce&&s.searchParams.append("nonce",e.nonce),e.loginHint&&s.searchParams.append("login_hint",e.loginHint),e.uiLocales&&s.searchParams.append("ui_locales",e.uiLocales),e.prompt&&s.searchParams.append("prompt",e.prompt),e.extraUrlParams)for(let t of Object.entries(e.extraUrlParams))t[1]&&s.searchParams.append(t[0],t[1]);return s.searchParams.set("criipto_sdk","@criipto/auth-js@3.6.1"),void 0!==(null===(t=e.extraUrlParams)||void 0===t?void 0:t.criipto_sdk)&&(null===(null===(r=e.extraUrlParams)||void 0===r?void 0:r.criipto_sdk)?s.searchParams.delete("criipto_sdk"):s.searchParams.set("criipto_sdk",null===(n=e.extraUrlParams)||void 0===n?void 0:n.criipto_sdk)),s.toString()}))}processResponse(e,t){if(e.error)return Promise.reject(new a(e.error,e.error_description,e.state));if(e.id_token)return Promise.resolve(e);if(!e.code)return Promise.resolve(null);if(e.code&&!t)return Promise.resolve(e);const r=e.state,n=new URLSearchParams;return n.append("grant_type","authorization_code"),n.append("code",e.code),n.append("client_id",this.clientID),n.append("redirect_uri",t.redirect_uri),n.append("code_verifier",t.code_verifier),this._setup().then((()=>window.fetch(this._openIdConfiguration.token_endpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},credentials:"omit",body:n.toString()}).then((e=>e.json())).then((e=>e.id_token?async function(e,t,r){var n;const o=await B(e,t,r);if((null===(n=o.protectedHeader.crit)||void 0===n?void 0:n.includes("b64"))&&!1===o.protectedHeader.b64)throw new v("JWTs MUST NOT use unencoded payload");const i={payload:j(o.protectedHeader,o.payload,r),protectedHeader:o.protectedHeader};return"function"==typeof t?{...i,key:o.key}:i}(e.id_token,ze(this,We,"f"),{issuer:this._openIdConfiguration.issuer,audience:this.clientID}).then((({payload:t})=>Object.assign(Object.assign({},e),{state:r,claims:t}))):Object.assign(Object.assign({},e),{state:r})))))}buildAuthorizeParams(e){const t=e.redirectUri||this.options.redirectUri,r=e.responseType||this.options.responseType||"code",n=e.acrValues||this.options.acrValues,o=e.scope||this.options.scope||"openid";if(!t)throw new Error("redirectUri must be defined");return{redirectUri:t,responseMode:e.responseMode||"query",responseType:r,acrValues:n,pkce:e.pkce,state:e.state,loginHint:e.loginHint,uiLocales:e.uiLocales,extraUrlParams:e.extraUrlParams,scope:o,prompt:e.prompt,nonce:e.nonce}}}})(),n.default})()));
//# sourceMappingURL=criipto-auth.umd.js.map